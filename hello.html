<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Impact - Interactive Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<!-- Blank Panel Section for Future Video -->
<section class="panel blank-panel" id="blank-panel-video" style="min-height:100vh; width:100vw; background:#000; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;">
  <video id="blank-panel-video-content" class="panel-video" autoplay muted loop playsinline preload="metadata" 
         style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover;"
         onloadstart="this.style.opacity='0.3';" 
         oncanplay="this.style.opacity='1'; this.style.transition='opacity 0.5s';">
    <source src="https://d1o1w8utcm6ojz.cloudfront.net/IntroHCMDraft.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</section>


<!-- PowerPoint Slide Deck Section -->
<section class="slideshow-section" style="padding: 3rem 2rem; background: #ffffff; text-align: center;">
  <div class="container" style="max-width: 1000px; margin: 0 auto;">
    <div class="section-header" style="margin-bottom: 2rem;">
      <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; color: #333;">Context</h2>
      <p style="font-size: 1.1rem; color: #666; max-width: 600px; margin: 0 auto;">Navigate through the presentation to understand the context of heat impact issues.</p>
    </div>
    
    <div class="slideshow-container" style="position: relative; max-width: 800px; margin: 0 auto; background: #f8f9fa; border-radius: 12px; padding: 2rem; box-shadow: 0 8px 32px rgba(0,0,0,0.15);">
             <!-- PDF Viewer -->
       <div class="pdf-viewer" style="width: 100%; height: 500px; border: 2px solid #e0e0e0; border-radius: 8px; background: #fff; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
         <iframe 
           src="Media/HeatImpactContextInformation.pdf" 
           width="100%" 
           height="100%" 
           frameborder="0" 
           style="border-radius: 6px;">
         </iframe>
       </div>
  </div>
</section>

<!-- Video Section -->
<section class="video-section" style="padding: 3rem 2rem; background: #f8f9fa; text-align: center;">
  <div class="container" style="max-width: 1000px; margin: 0 auto;">
    <div class="section-header" style="margin-bottom: 2rem;">
      <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; color: #333;">An Escalating Issue</h2>
      <p style="font-size: 1.1rem; color: #666; max-width: 600px; margin: 0 auto;">Watch this introductory video and then scroll down to the interactive map below.</p>
    </div>
    
    <div class="video-container" style="position: relative; max-width: 800px; margin: 0 auto;">
      <video controls preload="metadata" playsinline style="width: 100%; height: auto; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.15);">
        <source src="https://d1o1w8utcm6ojz.cloudfront.net/Issue.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
</section>

        <!-- Progress Indicator -->
        <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="font-weight: 600; color: #333;">Your Progress:</span>
                <span id="progress-text" style="color: #666; font-size: 0.9rem;">0/6 pins clicked (0%)</span>
            </div>
            <div style="background: #e9ecef; border-radius: 4px; height: 8px; overflow: hidden;">
                <div id="progress-bar" style="background: linear-gradient(90deg, #e94560, #ffd460); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
            </div>
        </div>

        <!-- Interactive Stakeholder Map Section -->
        <section class="interactive-map-section" id="stakeholder-map">
  <div class="interactive-map">
    <img src="Media/MapImage.png" alt="Heat Impact Interactive Map" class="background-img" />
    <!-- Main Navigation Pins -->
    <button class="pin infrastructure-pin" style="top: 50%; left: 20%;" aria-label="Firefighter" title="Infrastructure Impact"></button>
    <button class="pin health-pin" style="top: 66%; left: 17%;" aria-label="Doctor" title="Public Health Impact"></button>
    <button class="pin process-pin" style="top: 50%; left: 72%;" aria-label="Police Officer" title="Process Impact"></button>
  </div>
  <!-- Modal for content -->
  <div id="modal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
</section>
<style>
  .interactive-map-section {
    width: 100vw;
    max-width: 1100px;
    margin: 2rem auto;
    padding: 0;
    position: relative;
  }
  .interactive-map {
    position: relative;
    width: 100%;
    max-width: 1100px;
    margin: 0 auto;
  }
  .background-img {
    width: 100%;
    display: block;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
  }
  .pin {
    position: absolute;
    width: 40px;
    height: 40px;
    background: url('https://cdn-icons-png.flaticon.com/512/684/684908.png') no-repeat center/contain, #ffd460;
    border: 3px solid #e94560;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 0 3px rgba(255,255,255,0.8);
    backdrop-filter: blur(1px);
  }
  .infrastructure-pin {
    background: url('https://cdn-icons-png.flaticon.com/512/684/684908.png') no-repeat center/contain, #FF9800;
    border: 3px solid #F57C00;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 0 3px rgba(255,255,255,0.9), 0 0 20px rgba(255,152,0,0.6);
  }
  .health-pin {
    background: url('https://cdn-icons-png.flaticon.com/512/684/684908.png') no-repeat center/contain, #2196F3;
    border: 3px solid #1976D2;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 0 3px rgba(255,255,255,0.9), 0 0 20px rgba(33,150,243,0.6);
  }
  .process-pin {
    background: url('https://cdn-icons-png.flaticon.com/512/684/684908.png') no-repeat center/contain, #4CAF50;
    border: 3px solid #388E3C;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 0 3px rgba(255,255,255,0.9), 0 0 20px rgba(76,175,80,0.6);
  }
  .infrastructure-pin:hover, .infrastructure-pin:focus {
    transform: scale(1.3);
    box-shadow: 0 6px 16px rgba(0,0,0,0.5), 0 0 0 4px rgba(255,255,255,1), 0 0 30px rgba(255,152,0,0.8);
  }
  .health-pin:hover, .health-pin:focus {
    transform: scale(1.3);
    box-shadow: 0 6px 16px rgba(0,0,0,0.5), 0 0 0 4px rgba(255,255,255,1), 0 0 30px rgba(33,150,243,0.8);
  }
  .process-pin:hover, .process-pin:focus {
    transform: scale(1.3);
    box-shadow: 0 6px 16px rgba(0,0,0,0.5), 0 0 0 4px rgba(255,255,255,1), 0 0 30px rgba(76,175,80,0.8);
  }
  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex; align-items: center; justify-content: center;
    z-index: 1000;
  }
  .modal-content {
    background: #fff;
    padding: 2rem;
    border-radius: 16px;
    max-width: 500px;
    width: 90%;
    position: relative;
  }
  .close {
    position: absolute;
    top: 1rem; right: 1rem;
    font-size: 2rem;
    cursor: pointer;
  }
  .mindmap-svg {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 3;
  }
  .mindmap-node {
    cursor: pointer;
    pointer-events: all;
    transition: filter 0.2s;
  }
  .mindmap-node:hover {
    filter: drop-shadow(0 0 8px #e94560);
  }
  .mindmap-label {
    font-size: 1rem;
    font-weight: 600;
    fill: #23234b;
    text-anchor: middle;
    pointer-events: none;
  }
  #close-mindmap {
    position: absolute;
    top: 12px;
    right: 24px;
    z-index: 10;
    font-size: 2rem;
    background: #ffd460;
    border: 2px solid #e94560;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    line-height: 36px;
    text-align: center;
    padding: 0;
  }
</style>
<script>
          // Progress tracking functions with error handling
        function isLocalStorageAvailable() {
            try {
                const test = 'test';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch(e) {
                return false;
            }
        }

        function getProgress() {
            try {
                if (!isLocalStorageAvailable()) {
                    return { pinsClicked: [], localStorageFailed: true };
                }
                const progress = localStorage.getItem('heatImpactProgress');
                return progress ? JSON.parse(progress) : { pinsClicked: [] };
            } catch(e) {
                console.warn('Failed to get progress from localStorage:', e);
                return { pinsClicked: [], localStorageFailed: true };
            }
        }

        function markPinAsClicked(pinId) {
            try {
                const progress = getProgress();
                if (progress.localStorageFailed) {
                    // If localStorage failed, just show the CTA button
                    updateCallToActionButton(true);
                    return;
                }
                
                if (!progress.pinsClicked.includes(pinId)) {
                    progress.pinsClicked.push(pinId);
                    localStorage.setItem('heatImpactProgress', JSON.stringify(progress));
                    checkCompletionStatus();
                }
            } catch(e) {
                console.warn('Failed to mark pin as clicked:', e);
                // If marking fails, show CTA button anyway
                updateCallToActionButton(true);
            }
        }

        function checkCompletionStatus() {
            try {
                const progress = getProgress();
                
                if (progress.localStorageFailed) {
                    // If localStorage failed, show CTA button and hide progress indicator
                    updateCallToActionButton(true);
                    hideProgressIndicator();
                    return;
                }
                
                const allPins = ['infrastructure', 'public-health', 'processes', 'children', 'elderly', 'outdoors'];
                const isComplete = allPins.every(pin => progress.pinsClicked.includes(pin));
                
                // Update progress indicator
                updateProgressIndicator(progress.pinsClicked.length, allPins.length);
                
                // Show/hide call-to-action button
                updateCallToActionButton(isComplete);
            } catch(e) {
                console.warn('Failed to check completion status:', e);
                // If checking fails, show CTA button anyway
                updateCallToActionButton(true);
                hideProgressIndicator();
            }
        }

        function updateCallToActionButton(isComplete) {
            const ctaButton = document.getElementById('call-to-action-btn');
            if (ctaButton) {
                ctaButton.style.display = isComplete ? 'inline-block' : 'none';
            }
        }

        function updateProgressIndicator(clicked, total) {
            try {
                const percentage = Math.round((clicked / total) * 100);
                const progressBar = document.getElementById('progress-bar');
                const progressText = document.getElementById('progress-text');
                
                if (progressBar && progressText) {
                    progressBar.style.width = percentage + '%';
                    progressText.textContent = `${clicked}/${total} pins clicked (${percentage}%)`;
                }
            } catch(e) {
                console.warn('Failed to update progress indicator:', e);
            }
        }

        function hideProgressIndicator() {
            try {
                const progressContainer = document.querySelector('[style*="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;"]');
                if (progressContainer) {
                    progressContainer.style.display = 'none';
                }
            } catch(e) {
                console.warn('Failed to hide progress indicator:', e);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const pins = document.querySelectorAll('.pin');
            const modal = document.getElementById('modal');
            const modalBody = document.getElementById('modal-body');
            const closeBtn = document.querySelector('.close');
            
            // Check completion status when page loads
            checkCompletionStatus();
            
            pins.forEach(pin => {
                pin.addEventListener('click', function() {
                    const label = pin.getAttribute('aria-label');
                    const title = pin.getAttribute('title');
                    
                    // Mark pin as clicked based on label
                    let pinId = '';
                    switch(label) {
                        case 'Firefighter': pinId = 'infrastructure'; break;
                        case 'Doctor': pinId = 'public-health'; break;
                        case 'Police Officer': pinId = 'processes'; break;
                    }
                    markPinAsClicked(pinId);
        
        let content = '';
        let linkText = '';
        let linkUrl = '';
        let buttonColor = '';
        
        switch(label) {
          case 'Firefighter':
            content = 'Explore how extreme heat impacts critical infrastructure systems, emergency services, and urban resilience.';
            linkText = 'Explore Infrastructure Impact';
            linkUrl = 'infrastructure.html';
            buttonColor = '#FF9800';
            break;
          case 'Doctor':
            content = 'Discover the public health implications of extreme heat on vulnerable populations and healthcare systems.';
            linkText = 'Explore Public Health Impact';
            linkUrl = 'public-health.html';
            buttonColor = '#2196F3';
            break;
          case 'Police Officer':
            content = 'Learn about how extreme heat affects operational processes, emergency response, and public safety systems.';
            linkText = 'Explore Process Impact';
            linkUrl = 'processes.html';
            buttonColor = '#4CAF50';
            break;
          default:
            content = `Information about ${label}.`;
            linkText = 'Learn More';
            linkUrl = '#';
            buttonColor = '#e94560';
        }
        
        modalBody.innerHTML = `
          <h2>${title}</h2>
          <p>${content}</p>
          <a href="${linkUrl}" class="btn" style="display: inline-block; margin-top: 1rem; padding: 0.75rem 1.5rem; background: ${buttonColor}; color: white; text-decoration: none; border-radius: 8px;">${linkText}</a>
        `;
        modal.style.display = 'flex';
      });
    });

    closeBtn.onclick = () => modal.style.display = 'none';
    window.onclick = (e) => { if (e.target == modal) modal.style.display = 'none'; };
  });
</script>

<!-- Navigation Footer -->
<footer style="background: #f8f9fa; padding: 2rem; margin-top: 3rem; border-radius: 8px; text-align: center;">
    <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 1rem;">
        <a href="Main.html" style="display: inline-block; padding: 0.75rem 1.5rem; background: #e94560; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;"><i class="fas fa-home"></i> Main Page</a>
        <a href="infrastructure.html" style="display: inline-block; padding: 0.75rem 1.5rem; background: #FF9800; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;"><i class="fas fa-building"></i> Infrastructure</a>
        <a href="public-health.html" style="display: inline-block; padding: 0.75rem 1.5rem; background: #2196F3; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;"><i class="fas fa-heartbeat"></i> Public Health</a>
        <a href="processes.html" style="display: inline-block; padding: 0.75rem 1.5rem; background: #4CAF50; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;"><i class="fas fa-cogs"></i> Processes</a>
        <a id="call-to-action-btn" href="call-to-action.html" style="display: none; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #e94560, #ffd460); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);"><i class="fas fa-star"></i> Take Action!</a>
    </div>
</footer>

<!-- Copyright Footer -->
<footer style="background: #333; color: white; text-align: center; padding: 1rem; margin-top: 2rem;">
    <p>&copy; 2025 Impact of Heat Project. All rights reserved.</p>
</footer>
</body>
</html>
